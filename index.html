<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Xray Routing Editor</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<header class="header">
    <div class="header-content">
        <h1>
            <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" style="color: var(--primary)">
                <path d="M2 12h20"></path><path d="M20 12v6a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-6"></path><path d="M12 2 2 12h20L12 2z"></path>
            </svg>
            <span>Xray Config Editor</span>
        </h1>
        <div class="file-controls">
            <label class="file-btn">
                <span class="btn"><span id="statusConfig" class="status-dot"></span> Config</span>
                <input type="file" id="fileConfig" accept=".json">
            </label>
            <label class="file-btn">
                <span class="btn"><span id="statusGeoSite" class="status-dot"></span> GeoSite</span>
                <input type="file" id="fileGeoSite">
            </label>
            <label class="file-btn">
                <span class="btn"><span id="statusGeoIP" class="status-dot"></span> GeoIP</span>
                <input type="file" id="fileGeoIP">
            </label>
            <button id="themeToggle" class="btn">Theme</button>
            <button id="saveConfigBtn" class="btn btn-primary">Save JSON</button>
        </div>
    </div>
</header>

<div class="main-editor">
    <!-- SIDEBAR: RULES LIST -->
    <div class="sidebar">
        <div class="sidebar-header">
            <strong>Routing Rules</strong>
            <button id="addRuleBtn" class="btn btn-primary" style="padding: 0.2rem 0.5rem;">+</button>
        </div>
        <div id="rulesListContainer" class="rules-list">
            <div style="padding: 2rem 1rem; text-align: center; color: var(--text-light);">
                <p>1. Load <code>config.json</code></p>
                <p>2. Load <code>.dat</code> files (optional)</p>
            </div>
        </div>
    </div>

    <!-- MAIN: RULE EDITOR -->
    <div class="editor-panel">
        <button id="mobileBackBtn" class="btn mobile-back-btn">
            <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><polyline points="15 18 9 12 15 6"></polyline></svg>
            Back to Rules
        </button>

        <div id="emptyState" class="empty-state">
            <svg viewBox="0 0 24 24" width="48" height="48" stroke="var(--border)" stroke-width="1" fill="none" style="margin-bottom: 1rem;">
                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line>
            </svg>
            <h3>Select a rule to edit</h3>
        </div>

        <div id="editorForm" class="hidden" style="display: flex; flex-direction: column; gap: 1rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem;">
                <h3 style="margin: 0;">Rule #<span id="ruleIndexDisplay"></span></h3>
                <button id="deleteRuleBtn" class="btn" style="color: var(--danger); border-color: var(--danger);">Delete</button>
            </div>

            <div class="form-group">
                <label>Targets (Domain / IP / GeoSite)</label>
                <div class="tag-input-container" id="smartTagInput">
                    <input type="text" class="tag-input-field" id="smartInput" placeholder="Type & Enter..." autocomplete="off">
                    <div id="autocompleteList" class="autocomplete-dropdown hidden"></div>
                </div>
            </div>

            <div class="form-group">
                <label>Outbound Tag</label>
                <input type="text" id="ruleOutbound" class="tag-input-field" style="border: 1px solid var(--border); border-radius: 0.375rem; padding: 0.5rem; width: 100%;" placeholder="warp, blocked...">
                <div id="outboundSuggestions" class="outbound-cloud"></div>
            </div>

            <div class="form-group">
                <label>Protocol (Optional)</label>
                <div class="tag-input-container" id="protocolTagInput">
                    <input type="text" class="tag-input-field" id="protocolInput" placeholder="http, tls...">
                </div>
            </div>
            
            <button id="applyRuleBtn" class="btn btn-primary" style="margin-top: 1rem; width: 100%; justify-content: center; padding: 0.75rem;">Apply Changes</button>
        </div>
    </div>
</div>

<script src="js/app.js"></script>
<script src="https://unpkg.com/protobufjs/dist/protobuf.min.js"></script>
</body>
</html>